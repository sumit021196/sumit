import{N as B,j as e,r as a,aa as R,ab as G,C as j,T as n,P as N,B as o,I as v,A as J,a2 as K,b as z}from"./main-c94d187b.js";import{C as P}from"./Container-3f36393e.js";import{A as W}from"./Alert-2d396222.js";import{E as Q}from"./Edit-74b7be09.js";import{T as m}from"./TextField-26dbe2df.js";import"./Select-9fd389ba.js";import"./useControlled-94dd4eb6.js";const X=B(e.jsx("path",{d:"M12 2C6.47 2 2 6.47 2 12s4.47 10 10 10 10-4.47 10-10S17.53 2 12 2m5 13.59L15.59 17 12 13.41 8.41 17 7 15.59 10.59 12 7 8.41 8.41 7 12 10.59 15.59 7 17 8.41 13.41 12z"}),"Cancel"),Y=B(e.jsx("path",{d:"M17 3H5c-1.11 0-2 .9-2 2v14c0 1.1.89 2 2 2h14c1.1 0 2-.9 2-2V7zm-5 16c-1.66 0-3-1.34-3-3s1.34-3 3-3 3 1.34 3 3-1.34 3-3 3m3-10H5V5h10z"}),"Save");function ne(){const[b,x]=a.useState(!1),[h,f]=a.useState(""),[U,_]=a.useState(""),[p,y]=a.useState(""),[l,C]=a.useState(""),[g,S]=a.useState(""),[I,t]=a.useState(""),[E,d]=a.useState(""),[c,u]=a.useState(!1),{user:w,profile:r,loading:k,initialCheckComplete:F,updateProfile:L,updatePassword:M,signOut:T}=R(),q=G();a.useEffect(()=>{r&&(f(r.full_name||""),_(r.email||""))},[r]);const D=async s=>{if(s.preventDefault(),!h){t("Please enter your full name");return}u(!0),t(""),d("");try{const{error:i}=await L({full_name:h});if(i)throw i;d("Profile updated successfully"),x(!1)}catch(i){t(i.message||"Failed to update profile")}finally{u(!1)}},O=async s=>{if(s.preventDefault(),!p||!l||!g){t("Please fill in all password fields");return}if(l!==g){t("New passwords do not match");return}if(l.length<6){t("Password must be at least 6 characters long");return}u(!0),t(""),d("");try{const{user:i,error:H}=await signIn({email:w.email,password:p});if(H)throw new Error("Current password is incorrect");const{error:A}=await M(l);if(A)throw A;d("Password updated successfully"),y(""),C(""),S("")}catch(i){t(i.message||"Failed to update password")}finally{u(!1)}},V=async()=>{try{await T(),q("/")}catch(s){console.error("Error signing out:",s)}};return k||!F?e.jsxs(P,{maxWidth:"md",sx:{mt:4,textAlign:"center"},children:[e.jsx(j,{size:60}),e.jsx(n,{variant:"body1",sx:{mt:2},children:"Loading profile..."})]}):w?e.jsxs(P,{maxWidth:"md",sx:{mt:4,mb:4},children:[e.jsx(n,{variant:"h4",component:"h1",gutterBottom:!0,children:"My Profile"}),I&&e.jsx(W,{severity:"error",sx:{mb:3},children:I}),E&&e.jsx(W,{severity:"success",sx:{mb:3},children:E}),!r&&w?e.jsxs(N,{elevation:3,sx:{p:4,mb:4,textAlign:"center"},children:[e.jsx(j,{size:40}),e.jsx(n,{variant:"body1",sx:{mt:2},children:"Loading profile data..."})]}):e.jsxs(N,{elevation:3,sx:{p:4,mb:4},children:[e.jsxs(o,{display:"flex",justifyContent:"space-between",alignItems:"center",mb:3,children:[e.jsx(n,{variant:"h6",children:"Personal Information"}),b?e.jsxs(o,{children:[e.jsx(v,{color:"primary",onClick:D,disabled:c,"aria-label":"save changes",children:e.jsx(Y,{})}),e.jsx(v,{onClick:()=>{x(!1),t(""),d(""),f((r==null?void 0:r.full_name)||"")},disabled:c,"aria-label":"cancel editing",children:e.jsx(X,{})})]}):e.jsx(v,{color:"primary",onClick:()=>x(!0),"aria-label":"edit profile",children:e.jsx(Q,{})})]}),e.jsxs(o,{display:"flex",alignItems:"center",mb:4,children:[e.jsx(J,{sx:{width:80,height:80,fontSize:"2rem",bgcolor:"primary.main",mr:3},children:r!=null&&r.full_name?r.full_name.charAt(0).toUpperCase():"U"}),e.jsxs(o,{children:[b?e.jsx(m,{label:"Full Name",value:h,onChange:s=>f(s.target.value),variant:"outlined",size:"small",sx:{mb:1},fullWidth:!0}):e.jsx(n,{variant:"h6",children:(r==null?void 0:r.full_name)||"No name provided"}),e.jsx(n,{variant:"body2",color:"text.secondary",children:U})]})]}),e.jsx(K,{sx:{my:3}}),e.jsx(n,{variant:"h6",gutterBottom:!0,children:"Change Password"}),e.jsxs(o,{component:"form",onSubmit:O,noValidate:!0,children:[e.jsx(m,{margin:"normal",required:!0,fullWidth:!0,name:"currentPassword",label:"Current Password",type:"password",id:"currentPassword",autoComplete:"current-password",value:p,onChange:s=>y(s.target.value),sx:{mb:2}}),e.jsx(m,{margin:"normal",required:!0,fullWidth:!0,name:"newPassword",label:"New Password",type:"password",id:"newPassword",autoComplete:"new-password",value:l,onChange:s=>C(s.target.value),sx:{mb:2}}),e.jsx(m,{margin:"normal",required:!0,fullWidth:!0,name:"confirmPassword",label:"Confirm New Password",type:"password",id:"confirmPassword",value:g,onChange:s=>S(s.target.value),sx:{mb:3}}),e.jsx(z,{type:"submit",variant:"contained",disabled:c,startIcon:c?e.jsx(j,{size:20}):null,children:"Update Password"})]})]}),e.jsx(o,{textAlign:"center",mt:4,children:e.jsx(z,{variant:"outlined",color:"error",onClick:V,disabled:c,children:"Sign Out"})})]}):e.jsx(P,{maxWidth:"md",sx:{mt:4,textAlign:"center"},children:e.jsx(n,{variant:"h6",children:"Please sign in to view your profile"})})}export{ne as default};
//# sourceMappingURL=Profile-f6940561.js.map
